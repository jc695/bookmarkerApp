{% extends "layouts/base.html" %}

{% block content %}
<!-- Article Grid Container -->
<div class="article-grid-container">
    <!-- Header Section -->
    <div class="header-actions">
        <button id="refreshAllBtn">Refresh All Links</button>
        <input type="search" placeholder="Search articles..." id="searchInput">
    </div>

    <!-- Article Grid -->
    <div class="article-grid" id="articleGrid">
        {% for article in articles %}
            {% include "partials/article_card.html" %}
        {% endfor %}
    </div>
</div>

<!-- Create Collection Modal -->
<div class="modal" id="collectionModal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Create New Collection</h2>
        <form id="collectionForm">
            <div class="form-group">
                <label for="collectionName">Collection Name (100 chars max)</label>
                <input type="text" id="collectionName" maxlength="100" required>
            </div>
            <div class="form-group">
                <label for="collectionDescription">Description (Optional, 200 chars max)</label>
                <textarea id="collectionDescription" maxlength="200"></textarea>
            </div>
            <div class="button-group">
                <button type="button" class="secondary-btn" id="cancelCollection">Cancel</button>
                <button type="submit" class="primary-btn">Create Collection</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Modal functionality
document.getElementById('newCollectionBtn').addEventListener('click', () => {
    document.getElementById('collectionModal').style.display = 'block';
});

document.querySelector('.close-btn').addEventListener('click', () => {
    document.getElementById('collectionModal').style.display = 'none';
});

// Collection form submission
document.getElementById('collectionForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const collectionData = {
        name: document.getElementById('collectionName').value,
        description: document.getElementById('collectionDescription').value
    };

    try {
        const response = await fetch('/api/collections', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(collectionData)
        });
        
        if (response.ok) {
            location.reload(); // Refresh to show new collection
        }
    } catch (error) {
        console.error('Error creating collection:', error);
    }
});

// Search functionality
document.getElementById('searchInput').addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase();
    document.querySelectorAll('.article-card').forEach(card => {
        const title = card.querySelector('h3').textContent.toLowerCase();
        card.style.display = title.includes(term) ? 'block' : 'none';
    });
});
</script>
{% endblock %}